{
    "contents" : "library(RTCGA.clinical)\nlibrary(RTCGA.mRNA)\nlibrary(stringi)\nlibrary(ggplot2)\n#install.packages(\"survMisc\")\nlibrary(survMisc)\n\n#Ktore zbiory nalezy uwzględnić?\n?mRNA\n# BRCA.mRNA\n# COAD.mRNA\n# COADREAD.mRNA\n# GBMLGG.mRNA\n# KIPAN.mRNA\n# KIRC.mRNA\n# KIRP.mRNA\n# LGG.mRNA\n# LUAD.mRNA \n# LUSC.mRNA\n# OV.mRNA\n# READ.mRNA\n# UCEC.mRNA\ndata(\"BRCA.clinical\")\ndata(\"BRCA.mRNA\")\ndata(\"COAD.mRNA\")\ndata(\"COADREAD.mRNA\")\ndata(\"GBMLGG.mRNA\")\ndata(\"KIPAN.mRNA\")\ndata(\"KIRC.mRNA\")\ndata(\"KIRP.mRNA\")\ndata(\"LGG.mRNA\")\ndata(\"LUAD.mRNA\")\ndata(\"LUSC.mRNA\")\ndata(\"OV.mRNA\")\ndata(\"READ.mRNA\")\ndata(\"UCEC.mRNA\")\n\n#Tworzymy zbior dotyczacy pacjentow\n# cliS <- data.frame(time1=as.numeric(as.character(BRCA.clinical$patient.days_to_death)),\n#                    time2=as.numeric(as.character(BRCA.clinical$patient.days_to_last_followup)),\n#                    status = BRCA.clinical$patient.vital_status,\n#                    barcode = BRCA.clinical$patient.bcr_patient_barcode)\n# cliS$time <- ifelse(is.na(cliS$time1), cliS$time2, cliS$time1)\n# head(cliS)\n\nraki <- c(\"BRCA.mRNA\",\"COAD.mRNA\",\"COADREAD.mRNA\",\"GBMLGG.mRNA\",\"KIPAN.mRNA\",\n  \"KIRC.mRNA\",\"KIRP.mRNA\", \"LGG.mRNA\",\"LUAD.mRNA\",\"LUSC.mRNA\",\"OV.mRNA\",\"READ.mRNA\",\n  \"UCEC.mRNA\")\nzbior_wybranych <- vector(\"list\", length(raki))\nnames(zbior_wybranych) <- raki\n#Wybieramy konkretnego raka\nfor(j in 1:length(raki)){\n  rak <- stri_match_first_regex(raki[j],\"[^.]+\")[1,1]\n  eval(parse(text=paste0(\"cliS <- data.frame(time1=as.numeric(as.character(\",rak,\n                          \".clinical$patient.days_to_death)),\n                          time2=as.numeric(as.character(\",rak,\".clinical$patient.days_to_last_followup)),\n                     status = \",rak,\".clinical$patient.vital_status,\n                     barcode = \",rak, \".clinical$patient.bcr_patient_barcode)\")))\ncliS$time <- ifelse(is.na(cliS$time1), cliS$time2, cliS$time1)\neval(parse(text=paste0(\"zbior <- \",raki[j])))\nprint(raki[j])\nzbior[1:3,1:3]\nmedian(zbior[,3])\nnazwy <- colnames(zbior)\nn <- ncol(zbior)-1\npvalues <- rep(-1,n)\npacjenci <- stri_trans_tolower(stri_sub(zbior[,1],1,12))\nfor(i in 1:n){\n  gen <- zbior[,i+1]\n  nazwa_genu <- nazwy[i+1]\n  #Podlaczenie genu do zbioru z pacjentami\n  gen <-data.frame(pacjenci=pacjenci,gen=as.numeric(gen))\n  dane <- merge(gen, cliS, by.x = \"pacjenci\", by.y = \"barcode\")\n  mediana <- median(dane[,2],na.rm=TRUE)\n  n1 <- length(dane$gen)\n  n2 <- 0.2*n1\n  if(length(dane$gen[dane$gen>mediana])>n2 & length(dane$gen[dane$gen<mediana])>n2){\n    model <- survdiff(Surv(time, status == \"dead\")~(gen>mediana), data=dane)\n    pvalues[i] <-pchisq(model$chisq, 1, lower.tail=FALSE)\n  }\n  names(pvalues)[i] <- nazwa_genu\n  if(i%%1000==0){\n    print(i)\n  }\n}\n\n#Wybrane geny\nzbior_wybranych[[j]] <- sort(pvalues, decreasing=TRUE)\n}\n\nsave(zbior_wybranych,file=\"zbior_wybranych.RData\")\nload(\"zbior_wybranych.RData\")\nlength(zbior_wybranych[[1]])\nfor(i in 1:length(zbior_wybranych)){\n  z <- zbior_wybranych[[i]]\n  z <- z[z>=0]\n  z <- sort(z)[1:100]\n  zbior_wybranych[[i]]<-z\n}\nnames(zbior_wybranych) <- NULL\ntmp<- unlist(zbior_wybranych)\ntmp[1:5]\ntmp2 <- names(tmp)\ntmp2[1:5]\nk<-table(tmp2)\nsort(k, decreasing=TRUE)[1:20]\n# CIP29      FXR1     GNB1L LOC146325 MPHOSPH10   SYNPO2L     TMOD2      UBTF     ACAD9    ADRA2A \n# 3         3         3         3         3         3         3         3         2         2 \n\n\n# C7orf47     FCRL5     NCBP2    OR5AS1    PPP3CA  RPGRIP1L     SETD4     SNIP1     ACADM       AGK \n# 3         3         3         3         3         3         3         3\nwykres_genu <- function(rak,nazwa_genu){\n  eval(parse(text=paste0(\"cliS <- data.frame(time1=as.numeric(as.character(\",rak,\n                       \".clinical$patient.days_to_death)),\n                       time2=as.numeric(as.character(\",rak,\".clinical$patient.days_to_last_followup)),\n                       status = \",rak,\".clinical$patient.vital_status,\n                       barcode = \",rak, \".clinical$patient.bcr_patient_barcode)\")))\n  cliS$time <- ifelse(is.na(cliS$time1), cliS$time2, cliS$time1)\n  eval(parse(text=paste0(\"zbior <- \",paste0(rak,\".mRNA\"))))\n  kolumna <- which(colnames(zbior)==nazwa_genu)\n  zbior[1:5,c(1,7774)]\n  pacjenci <- stri_trans_tolower(stri_sub(zbior[,1],1,12))\n  gen <- zbior[,kolumna]\n  names(zbior)[kolumna]\n  #Podlaczenie genu do zbioru z pacjentami\n  gen <-data.frame(pacjenci=pacjenci,gen=as.numeric(gen))\n  dane <- merge(gen, cliS, by.x = \"pacjenci\", by.y = \"barcode\")\n  mediana <- median(dane[,2],na.rm=TRUE)\n  model <- survdiff(Surv(time, status == \"dead\")~(gen>mediana), data=dane)\n  print(pchisq(model$chisq, 1, lower.tail=FALSE))\n  #Wykres\n  ob2 <- survfit(Surv(time, status == \"dead\")~(gen>mediana), data=dane)\n  return(ob2)\n}\nktore_raki <- function(nazwa_genu){\n  \n  raki <- c(\"BRCA.mRNA\",\"COAD.mRNA\",\"COADREAD.mRNA\",\"GBMLGG.mRNA\",\"KIPAN.mRNA\",\n            \"KIRC.mRNA\",\"KIRP.mRNA\", \"LGG.mRNA\",\"LUAD.mRNA\",\"LUSC.mRNA\",\"OV.mRNA\",\"READ.mRNA\",\n            \"UCEC.mRNA\")\n  load(\"zbior_wybranych.RData\")\n  for(i in 1:length(zbior_wybranych)){\n    z <- zbior_wybranych[[i]]\n    z <- z[z>=0]\n    z <- sort(z)[1:100]\n   zbior_wybranych[[i]]<-z\n  }\n  ktore <- numeric(length(raki))\n  for(i in 1:length(zbior_wybranych)){\n  ktore[i] <- zbior_wybranych[[i]][nazwa_genu]\n  }\n  return(raki[which(!is.na(ktore))])\n}\n\nprint(ktore_raki(\"CIP29\")) # \"GBMLGG.mRNA\" \"LGG.mRNA\"    \"LUSC.mRNA\"  \n#Pierwszy gen\nautoplot(wykres_genu(\"GBMLGG\",\"CIP29\"))\nautoplot(wykres_genu(\"LGG\",\"CIP29\"))\nautoplot(wykres_genu(\"LUSC\",\"CIP29\"))\n\n\n\nprint(ktore_raki(\"C7orf47\"))\n#Drugi gen\nautoplot(wykres_genu(\"COAD\",\"C7orf47\"))\nautoplot(wykres_genu(\"COADREAD\",\"C7orf47\"))\nautoplot(wykres_genu(\"KIPAN\",\"C7orf47\"))\n\n\n\n\nprint(ktore_raki(\"DEDD2\")) #\"GBMLGG.mRNA\" \"LGG.mRNA\"    \"LUAD.mRNA\"\n#Trzeci gen\nautoplot(wykres_genu(\"GBMLGG\",\"DEDD2\"))\nautoplot(wykres_genu(\"LGG\",\"DEDD2\"))\nautoplot(wykres_genu(\"LUAD\",\"DEDD2\"))\n\nktore_raki(\"FCRL5\") #\"KIPAN.mRNA\" \"KIRC.mRNA\"  \"UCEC.mRNA\" \nautoplot(wykres_genu(\"KIPAN\",\"FCRL5\"))\nautoplot(wykres_genu(\"KIRC\",\"FCRL5\"))\nautoplot(wykres_genu(\"UCEC\",\"FCRL5\"))\n\nhist(BRCA.mRNA[,\"FCRL5\"])\n",
    "created" : 1452510048140.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "345620044",
    "id" : "9AFAACD8",
    "lastKnownWriteTime" : 1450277182,
    "path" : "C:/Users/wyszy/OneDrive/Studia/Magisterka/Rok 2 sem 1/Warsztaty badawcze/Praca domowa 1.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}