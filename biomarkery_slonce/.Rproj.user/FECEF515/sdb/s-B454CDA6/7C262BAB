{
    "contents" : "library(ggplot2)\nlibrary(survMisc)\nlibrary(RTCGA.mRNA)\nlibrary(RTCGA.clinical)\ncancer_types<-c(\"BRCA\",\"COAD\",\"COADREAD\",\"GBMLGG\",\"KIPAN\",\"KIRC\",\"KIRP\",\"LGG\",\n                \"LUAD\",\"LUSC\",\"OV\",\"READ\",\"UCEC\")\nfor (j in 2:length(cancer_types))\n{\n   p<-sprintf(\"%s.mRNA\",cancer_types[j])\n   q<-sprintf(\"%s.clinical\",cancer_types[j])\n   namep<-data(list=p)\n   nameq<-data(list=q)\n   \n   \n   mBRCA<-.GlobalEnv[[namep]]\n   cBRCA<-.GlobalEnv[[nameq]]\n   cBRCA <- data.frame(time1=as.numeric(as.character(cBRCA$patient.days_to_death)),\n                       time2=as.numeric(as.character(cBRCA$patient.days_to_last_followup)),\n                       status = cBRCA$patient.vital_status,\n                       barcode = cBRCA$patient.bcr_patient_barcode,\n                       race=cBRCA$patient.race,\n                       therapy=cBRCA$patient.drugs.drug.therapy_types.therapy_type)\n   cBRCA$time <- ifelse(is.na(cBRCA$time1), cBRCA$time2, cBRCA$time1)\n   mBRCA$bcr_patient_barcode<-tolower(substr(mBRCA$bcr_patient_barcode, 1, 12))\n   allBRCA<-merge(mBRCA,cBRCA,by.x=\"bcr_patient_barcode\",by.y=\"barcode\")\n   length_gen<-length(2:ncol(mBRCA))\n   histy<-list()\n   survy<-list()\n   geny<-c()\n   pvalues <- c()\n   for(i in 2:ncol(mBRCA))\n   {\n      tylko_jeden_gen <- allBRCA[,c(1,i,(ncol(mBRCA)+1):ncol(allBRCA))]\n      geny[i-1]<- names(tylko_jeden_gen)[2]\n      names(tylko_jeden_gen)[2]<-\"val\"\n      med<-median(na.omit(tylko_jeden_gen$val))\n      prog <- 0.2*length(tylko_jeden_gen$val)\n      tryCatch({\n         if(length(tylko_jeden_gen$val[tylko_jeden_gen$val>med])>prog & length(\n            tylko_jeden_gen$val[tylko_jeden_gen$val<med])>prog){\n            model <- survdiff(Surv(time, status == \"dead\")~(val>med),\n                              data=tylko_jeden_gen)\n            pvalues[i-1] <- pchisq(model$chisq, 1, lower.tail=FALSE)\n         } else{\n            pvalues[i-1] <- 100; #Wystarczajaco duza wartosc zeby zmienna byla \n                                 #\"nieistotna\"\n         }\n      },\n      error = function(e) {\n         print(paste0(\"zlo_model\",i))\n      })\n\n         tryCatch({\n            p<-survfit(Surv(time, status == \"dead\")~(val>med), data=tylko_jeden_gen)\n            survy[[i-1]]<-p\n            names(survy)[i-1] <- geny[i-1]\n            \n         },\n         error = function(e) {\n            print(paste0(\"zlo_surv\",i))\n         })\n         tryCatch({\n\n            q <- tylko_jeden_gen[,'val',drop=FALSE]\n            histy[[i-1]]<-q\n            names(histy)[i-1] <- geny[i-1]\n         },\n         error = function(e) {\n            print(paste0(\"zlo_hist\",i))\n         })\n      if(i/1000==round(i/1000))\n      {\n         print(paste(j,i))\n      }   \n   }\n   #### Wybranie 1000 najbardziej istotnych genow\n   names(pvalues) <- geny\n   pvalues <- sort(pvalues)[1:1000]\n   geny_interesujace <- names(pvalues)\n   #save(geny_interesujace, file=\"D:/geny_interesujace_BRCA.RData\")\n   survy <- survy[geny_interesujace]\n   histy <- histy[geny_interesujace]\n   if(!(dir.exists(paste0(\"./\",cancer_types[j]))))\n   {\n      dir.create(paste0(\"./\",cancer_types[j])) \n   }\n   saveRDS(geny_interesujace,paste0(\"./\",cancer_types[j],\"/geny.RDS\"))\n   saveRDS(survy,paste0(\"./\",cancer_types[j],\"/survy.RDS\"))\n   saveRDS(histy,paste0(\"./\",cancer_types[j],\"/histy.RDS\"))\n}",
    "created" : 1452453305152.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3692635977",
    "id" : "7C262BAB",
    "lastKnownWriteTime" : 1452552911,
    "path" : "C:/Users/wyszy/OneDrive/Studia/Magisterka/Rok 2 sem 1/Warsztaty badawcze/Projekt koÅ„cowy/biomarkery_slonce/doshiny.R",
    "project_path" : "doshiny.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}